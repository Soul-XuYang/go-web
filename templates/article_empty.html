<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>æˆ‘çš„æ–‡ç«  Â· é¦–æ¬¡ä½¿ç”¨</title>
    <link rel="stylesheet" href="/static/base.css" />
    <style>
        body {
            max-width: 960px;
            margin: 40px auto;
            padding: 0 16px;
            font-family: system-ui
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px
        }

        .btn {
            padding: 8px 14px;
            border: 1px solid #ddd;
            border-radius: 10px;
            cursor: pointer
        }

        .card {
            border: 1px solid #eee;
            padding: 16px;
            border-radius: 14px;
            margin: 10px 0
        }

        form input,
        form textarea {
            width: 100%;
            margin: 6px 0;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 10px
        }

        .muted {
            color: #888;
            font-size: 13px
        }
    </style>
</head>

<body>
    <header>
        <div>
            <div class="muted">å·²ç™»å½•ç”¨æˆ·</div>
            <h2 id="username">{{ .username }}</h2>
        </div>
        <div>
            <a class="btn" href="/rates">å»æŸ¥è¯¢æ±‡ç‡</a>
            <button class="btn" id="logout">é€€å‡º</button>
        </div>
    </header>

    <section class="card">
        <h3>æ¬¢è¿æ¥åˆ°ä½ çš„ç©ºé—´ ğŸ‘‹</h3>
        <p class="muted">ä½ è¿˜æ²¡æœ‰ä»»ä½•æ–‡ç« ï¼Œå…ˆåˆ›å»ºç¬¬ä¸€ç¯‡å§ï½</p>
        <form id="createForm">
            <input name="title" placeholder="æ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰" required maxlength="200" />
            <textarea name="preview" placeholder="æ‘˜è¦ï¼ˆå¿…å¡«ï¼‰" required></textarea>
            <textarea name="content" placeholder="æ­£æ–‡ï¼ˆå¿…å¡«ï¼‰" required></textarea>
            <button class="btn" type="submit">å‘å¸ƒé¦–ç¯‡æ–‡ç« </button>
            <span id="cmsg" class="muted"></span>
        </form>
    </section>

    <script>
        const $ = s => document.querySelector(s);
        const token = localStorage.getItem('token');
        if (!token) { location.href = '/auth/login'; }

        function authFetch(url, opts = {}) {
            const headers = Object.assign({ 'Content-Type': 'application/json', 'Authorization': token }, opts.headers || {});
            return fetch(url, Object.assign(opts, { headers }));
        }

        $('#logout').onclick = () => { localStorage.removeItem('token'); location.href = '/auth/login'; };

        $('#createForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const f = e.target, msg = $('#cmsg');
            const payload = {
                title: f.title.value.trim(),
                preview: f.preview.value.trim(),
                content: f.content.value.trim(),
            };
            const r = await authFetch('/api/articles', { method: 'POST', body: JSON.stringify(payload) });
            const d = await r.json().catch(() => ({}));
            if (r.ok) {
                msg.textContent = 'å‘å¸ƒæˆåŠŸï¼Œæ­£åœ¨è¿›å…¥æ–‡ç« ä¸»é¡µâ€¦';
                // é‡æ–°æ‰“å¼€ /articlesï¼Œåç«¯ä¼šæ¸²æŸ“â€œè€ç”¨æˆ·æ¨¡æ¿â€
                location.href = '/articles';
            } else {
                msg.textContent = d.error || 'å‘å¸ƒå¤±è´¥';
            }
        });
    </script>
</body>

</html>